#!/usr/bin/env bash
set -euo pipefail

git diff --cached --name-only | grep -q "gradle.properties" || exit 0
echo "[pre-commit] gradle.properties changed -> publishing manifest"

command -v aws >/dev/null || { echo "[pre-commit] aws CLI missing"; exit 1; }
command -v ./gradlew >/dev/null || { echo "[pre-commit] Gradle wrapper missing"; exit 1; }

# Require creds (SSO or otherwise)
aws sts get-caller-identity >/dev/null 2>&1 || {
    echo "[pre-commit] No AWS creds. Run: aws sso login"; 
    exit 1; 
}

./gradlew publishManifestIfChanged
